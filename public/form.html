<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://d1ukdhoxof1oxs.cloudfront.net/pipefy-client.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" media="all" href="https://s3.amazonaws.com/pipestyle/3.5.12/assets/stylesheets/platform-apps.css" />
    <style>
      svg {
        fill: currentColor;
      }
    </style>
</head>
  <body>
  <div id="content">
      <label for="shopping"><b class="pp-label-text">Shopping</b></label>
      <select id="shopping" name="shopping" class="pp-custom-select" onchange="populaEmpresa($(this).val())"> 
      </select>

      <br>     

      <label for="empresa"><b class="pp-label-text">Empresa</b></label>
      <select id="empresa" name="empresa" class="pp-custom-select" onchange="alert(this.selectedIndex)"> 
      </select>
      <br>

      <label for="empresa2"><b class="pp-label-text">Empresa</b></label>
      <select id="empresa2" name="empresa2" class="pp-custom-select" onchange="alert(this.selectedIndex)"> 
      </select>
      <br>      

      <a href="javascript:close()" class="pp-btn"><span>Salvar</span></a>
      <br>
      <br>
  </div>
<script>

  /* popula shopping*/
  $.ajax({ 
      url: "/services/shoppings.json?"+Math.random()
  }).then(function(data) {
        //var data = JSON.parse(data);  
        for( var i = 0 ; i < data.length ; i++ ){
            $('#shopping').append('<option value=' + data[i].value + '>' + data[i].value + ' - ' +data[i].text + '</option>'); 
        } 
        if(data.length>0)
          populaEmpresa(data[0].value);
  });
  /* popula shopping*/

  function populaEmpresa(value){
    /* popula empresa*/
    $.ajax({ 
        url: "/services/empresas.json?"+Math.random()
    }).then(function(data) {
          //var data = JSON.parse(data);  
          $('#empresa').html('');
          for( var i = 0 ; i < data.length ; i++ ){
              $('#empresa').append('<option value=' + data[i].value + '>id do shopping:' + value + ' - ' +data[i].text + '</option>'); 
          }     
    });
    /* popula empresa*/
  }

  var p = PipefyApp.init();
  PipefyApp.resizeTo('#content');

  function close(){
    p.get('card', 'public', 'test').then((test) => {
      console.log(test); // return actual value stored
    }).catch((error) => {
      // Handle error
      console.log(error);
    });
    p.showNotification('Formulario salvo!', 'success');
    
  }




</script>

  </body>
</html>
